function PowermailForm(a){this.initialize=function(){n();a("form[data-powermail-ajax]").length&&p();q();r();a(".powermail_all_type_password.powermail_all_value").html("********");t();k();window.Parsley&&(u(),v())};var n=function(){a.fn.powermailTabs&&a(".powermail_morestep").each(function(){a(this).powermailTabs()})},q=function(){a('*[data-powermail-location="prefill"]').length&&navigator.geolocation&&(a(this),navigator.geolocation.getCurrentPosition(function(b){var d=b.coords.latitude;b=b.coords.longitude;var c=(0<a("base").length?jQuery("base").prop("href"):"https:"!=window.location.protocol?"http://"+window.location.hostname:"https://"+window.location.hostname)+"/index.php?eID=powermailEidGetLocation";jQuery.ajax({url:c,data:"lat="+d+"&lng="+b,cache:!1,success:function(e){e&&a('*[data-powermail-location="prefill"]').val(e)}})}))},r=function(){a.fn.datetimepicker&&a(".powermail_date").each(function(){var b=a(this);if("date"===b.prop("type")||"datetime-local"===b.prop("type")||"time"===b.prop("type"))if(b.data("datepicker-force"))b.prop("type","text"),b.val(a(this).data("date-value"));else{if(a(this).data("date-value")){var d=a(this).data("date-value"),c=a(this).data("datepicker-format");b=b.prop("type");d=Date.parseDate(d,c);null===d?b=null:(c=new Date(d),d=c.getFullYear()+"-",d+=("0"+(c.getMonth()+1)).slice(-2)+"-",d+=("0"+c.getDate()).slice(-2),c=("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2),b="date"===b?d:"datetime-local"===b?d+"T"+c:"time"===b?c:null);null!==b&&a(this).val(b)}return}c=d=!0;"date"===b.data("datepicker-settings")?c=!1:"time"===b.data("datepicker-settings")&&(d=!1);b.datetimepicker({format:b.data("datepicker-format"),timepicker:c,datepicker:d,lang:"en",i18n:{en:{months:b.data("datepicker-months").split(","),dayOfWeek:b.data("datepicker-days").split(",")}}})})},t=function(){if(a.fn.parsley)a(".powermail_reset").on("click","",function(){a('form[data-parsley-validate="data-parsley-validate"]').parsley().reset()})},p=function(){var b=!1,d;a(document).on("submit","form[data-powermail-ajax]",function(c){var e=a(this),g=e.closest(".tx-powermail");e.data("powermail-ajax-uri")&&(d=e.data("powermail-ajax-uri"));var h=e.data("powermail-ttcontentuid");b||(a.ajax({type:"POST",url:e.prop("action"),data:new FormData(e.get(0)),contentType:!1,processData:!1,beforeSend:function(){l(e);a(".powermail_submit",e).length?a(".powermail_submit",e).parent().append(m()):e.closest(".tx-powermail").append(m())},complete:function(){l(e);k();var f=a.Event("submitted.powermail.form");g.trigger(f)},success:function(f){f=a('*[data-powermail-ttcontentuid="'+h+'"]:first',f);f.length?(a('*[data-powermail-ttcontentuid="'+h+'"]:first').closest(".tx-powermail").html(f),a.fn.powermailTabs&&a(".powermail_morestep").powermailTabs(),a.fn.parsley&&a('form[data-parsley-validate="data-parsley-validate"]').parsley(),w()):(d?(f=d,-1!==f.indexOf("http")?window.location=f:window.location.pathname=f):e.submit(),b=!0)}}),c.preventDefault())})},l=function(b){b.closest(".tx-powermail").find(".powermail_progressbar").remove()},k=function(){a(".powermail_fieldwrap_file").find(".deleteAllFiles").each(function(){a(this).closest(".powermail_fieldwrap_file").find('input[type="file"]').prop("disabled","disabled").addClass("hide").prop("type","hidden")});a(".deleteAllFiles").click(function(){a(this).closest(".powermail_fieldwrap_file").find('input[type="hidden"]').prop("disabled",!1).removeClass("hide").prop("type","file");a(this).closest("ul").fadeOut(function(){a(this).remove()})})},w=function(){a("img.powermail_captchaimage").each(function(){var b=a(this).prop("src").split("?")[0];for(var d=a(this),c=d.prop,e="",g=0;5>g;g++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));c.call(d,"src",b+"?hash="+e)})},m=function(){return a("<div />").addClass("powermail_progressbar").html(a("<div />").addClass("powermail_progress").html(a("<div />").addClass("powermail_progress_inner")))},u=function(){window.Parsley.addValidator("powermailfilesize",function(b,d){if(-1!==d.indexOf(",")){var c=d.split(","),e=parseInt(c[0]);c=a('*[name="tx_powermail_pi1[field]['+c[1]+'][]"]');if(c.length){c=c.get(0);for(var g=0,h=0;h<c.files.length;h++){var f=c.files[h];f.size>g&&(g=f.size)}if(parseInt(g)>e)return!1}}return!0},32).addMessage("en","powermailfilesize","Error")},v=function(){window.Parsley.addValidator("powermailfileextensions",function(b,d){var c=a('*[name="tx_powermail_pi1[field]['+d+'][]"]');if(c.length){var e=b.split(".").pop().toLowerCase();return-1!==c.prop("accept").indexOf("."+e)}return!0},32).addMessage("en","powermailfileextensions","Error")}}jQuery(document).ready(function(a){(new window.PowermailForm(a)).initialize()});