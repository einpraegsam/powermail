function PowermailForm(e){"use strict";var t=this;this.initialize=function(){a(),i(),r(),o(),n(),l(),t.deleteAllFilesListener(),s()};var a=function(){e.fn.powermailTabs&&e(".powermail_morestep").each(function(){e(this).powermailTabs()})},i=function(){e("form[data-powermail-ajax]").length&&p()},r=function(){if(e('*[data-powermail-location="prefill"]').length&&navigator.geolocation){e(this);navigator.geolocation.getCurrentPosition(function(t){var a=t.coords.latitude,i=t.coords.longitude,r=b()+"/index.php?eID=powermailEidGetLocation";jQuery.ajax({url:r,data:"lat="+a+"&lng="+i,cache:!1,success:function(t){t&&e('*[data-powermail-location="prefill"]').val(t)}})})}},o=function(){e.fn.datetimepicker&&e(".powermail_date").each(function(){var t=e(this);if("date"===t.prop("type")||"datetime-local"===t.prop("type")||"time"===t.prop("type")){if(!t.data("datepicker-force")){if(e(this).data("date-value")){var a=m(e(this).data("date-value"),e(this).data("datepicker-format"),t.prop("type"));null!==a&&e(this).val(a)}return}t.prop("type","text"),t.val(e(this).data("date-value"))}var i=!0,r=!0;"date"===t.data("datepicker-settings")?r=!1:"time"===t.data("datepicker-settings")&&(i=!1),t.datetimepicker({format:t.data("datepicker-format"),timepicker:r,datepicker:i,lang:"en",i18n:{en:{months:t.data("datepicker-months").split(","),dayOfWeek:t.data("datepicker-days").split(",")}}})})},n=function(){e(".powermail_all_type_password.powermail_all_value").html("********")},l=function(){e.fn.parsley&&e(".powermail_reset").on("click","",function(){e('form[data-parsley-validate="data-parsley-validate"]').parsley().reset()})},s=function(){window.Parsley&&(v(),g())},p=function(){var a,i=!1;e(document).on("submit","form[data-powermail-ajax]",function(r){var o=e(this),n=o.closest(".tx-powermail");o.data("powermail-ajax-uri")&&(a=o.data("powermail-ajax-uri"));var l=o.data("powermail-form");i||(e.ajax({type:"POST",url:o.prop("action"),data:new FormData(o.get(0)),contentType:!1,processData:!1,beforeSend:function(){addProgressbar(o)},complete:function(){t.removeProgressbar(o).deleteAllFilesListener().fireAjaxCompleteEvent(n)},success:function(r){var n=e('*[data-powermail-form="'+l+'"]:first',r);n.length?(e('*[data-powermail-form="'+l+'"]:first').closest(".tx-powermail").html(n),e.fn.powermailTabs&&e(".powermail_morestep").powermailTabs(),e.fn.parsley&&e('form[data-parsley-validate="data-parsley-validate"]').parsley(),t.reloadCaptchaImages()):(a?t.redirectToUri(a):o.submit(),i=!0)}}),r.preventDefault())})};this.addProgressbar=function(a){return t.removeProgressbar(a),e(".powermail_submit",a).length?e(".powermail_submit",a).parent().append(h()):a.closest(".tx-powermail").append(h()),this},this.removeProgressbar=function(e){return e.closest(".tx-powermail").find(".powermail_progressbar").remove(),this},this.fireAjaxCompleteEvent=function(t){var a=e.Event("submitted.powermail.form");return t.trigger(a),this},this.deleteAllFilesListener=function(){return e(".powermail_fieldwrap_file").find(".deleteAllFiles").each(function(){d(e(this).closest(".powermail_fieldwrap_file").find('input[type="file"]'))}),e(".deleteAllFiles").click(function(){c(e(this).closest(".powermail_fieldwrap_file").find('input[type="hidden"]')),e(this).closest("ul").fadeOut(function(){e(this).remove()})}),this};var d=function(e){e.prop("disabled","disabled").addClass("hide").prop("type","hidden")},c=function(e){e.prop("disabled",!1).removeClass("hide").prop("type","file")};this.reloadCaptchaImages=function(){return e("img.powermail_captchaimage").each(function(){var t=f(e(this).prop("src"));e(this).prop("src",t+"?hash="+u(5))}),this};var f=function(e){var t=e.split("?");return t[0]},u=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*a.length));return t},m=function(e,t,a){var i=Date.parseDate(e,t);if(null===i)return null;var r=new Date(i),o=r.getFullYear()+"-";o+=("0"+(r.getMonth()+1)).slice(-2)+"-",o+=("0"+r.getDate()).slice(-2);var n=("0"+r.getHours()).slice(-2)+":"+("0"+r.getMinutes()).slice(-2),l=o+"T"+n;return"date"===a?o:"datetime-local"===a?l:"time"===a?n:null},h=function(){return e("<div />").addClass("powermail_progressbar").html(e("<div />").addClass("powermail_progress").html(e("<div />").addClass("powermail_progress_inner")))},w=function(e){for(var t=e.get(0),a=0,i=0;i<t.files.length;i++){var r=t.files[i];r.size>a&&(a=r.size)}return parseInt(a)},v=function(){window.Parsley.addValidator("powermailfilesize",function(t,a){if(a.indexOf(",")!==-1){var i=a.split(","),r=parseInt(i[0]),o=e('*[name="tx_powermail_pi1[field]['+i[1]+'][]"]');if(o.length&&w(o)>r)return!1}return!0},32).addMessage("en","powermailfilesize","Error")},g=function(){window.Parsley.addValidator("powermailfileextensions",function(t,a){var i=e('*[name="tx_powermail_pi1[field]['+a+'][]"]');return!i.length||y(_(t),i.prop("accept"))},32).addMessage("en","powermailfileextensions","Error")},y=function(e,t){return t.indexOf("."+e)!==-1},_=function(e){return e.split(".").pop().toLowerCase()};this.redirectToUri=function(e){return e.indexOf("http")!==-1?window.location=e:window.location.pathname=e,this};var b=function(){var t;return t=e("base").length>0?jQuery("base").prop("href"):"https:"!=window.location.protocol?"http://"+window.location.hostname:"https://"+window.location.hostname}}jQuery(document).ready(function(e){"use strict";var t=new window.PowermailForm(e);t.initialize()});